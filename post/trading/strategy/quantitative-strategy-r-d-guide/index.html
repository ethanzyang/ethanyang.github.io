<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=msapplication-TileColor content="#1793d0"><meta name=theme-color content="#1793d0"><title>四海之内皆准的法则 | 量化策略研发指北 | Jerrkill - 为学日益为道日损</title><meta property="og:title" content="四海之内皆准的法则 | 量化策略研发指北 - Jerrkill - 为学日益为道日损"><meta property="og:type" content="article"><meta property="article:published_time" content="2023-02-04T01:50:00+08:00"><meta property="article:modified_time" content="2023-02-04T01:50:00+08:00"><meta name=keywords content="Blog,Golang,PHP,blockchain,trading,life"><meta name=description content="四海之内皆准的法则 | 量化策略研发指北"><meta name=author content><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=stylesheet type=text/css href=/css/hulga.min.css><link rel=stylesheet type=text/css href=/css/hulga-dark.min.css media="(prefers-color-scheme: dark)"><link rel=manifest href=/manifest.json></head><body><div id=main><section class="hero is-primary shadow-hero"><div class=hero-head><nav class="navbar is-primary"><div class=container><div class=navbar-brand><a class=navbar-item href=/>Jerrkill - 为学日益为道日损</a>
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div class=navbar-menu id=navMenu><div class=navbar-end><a class=navbar-item href=/ title=index>首页</a>
<a class=navbar-item href=/archives/ title=archives>归档</a>
<a class=navbar-item href=/tags/ title=tags>标签</a>
<a class=navbar-item href=/categories/ title=categories>类别</a>
<a class=navbar-item href=/about/ title=about>关于</a></div></div></div></nav></div><div class=hero-body><header class="container has-text-centered"><h1 class="title post-title">四海之内皆准的法则 | 量化策略研发指北</h1><h2 class=subtitle><time class=post-meta>2023/02/04</time> ・
<span class="post-tag post-meta"><a href=/categories/trading>trading</a></span></h2><div class="tagbox post-meta"><span class=post-tag><a href=/tags/trading-system>#trading-system</a></span></div></header></div></section><section class=section><div class=container><div class=columns><div class="column is-1 is-hidden-mobile"></div><div class="column is-8"><article class=content id=post-content><h1 id=引言>引言</h1><p>最近研发了趋势跟踪策略，建立一套理论模型，简单的介绍下量化策略研发的模型建立过程，抛砖引玉。</p><p>最终回测结果</p><p><img src=/images/trading/backtrade/s1_m1_0.png alt=取值一></p><h1 id=理论基础>理论基础</h1><h2 id=关键术语>关键术语</h2><ul><li>收敛</li><li>震荡</li><li>突破</li><li>冷却</li><li>波动率</li></ul><h2 id=定理>定理</h2><blockquote><p>市场是无序的但市场是有周期的</p></blockquote><blockquote><p>一段长期趋势中包含多段中期趋势</p></blockquote><blockquote><p>一段中期趋势中包含多段短期趋势</p></blockquote><h2 id=目标>目标</h2><blockquote><p><strong>短期趋势跟踪策略</strong></p></blockquote><p>flag</p><ul><li>回测控制小于等于 <code>7%</code></li><li>月化收益率大于等于 <code>5%</code></li><li>盈利因子大于等于 <code>2</code></li></ul><h2 id=特征提取>特征提取</h2><p>由以上定理可得</p><ol><li>市场经过一段时间在一个价格区间内无规则的收敛震荡运动后大概率会出现一个跟收敛区间同比例的向上或向下的趋势（横有多长竖有多长）</li></ol><p>由上面一段话得到三个问题</p><ul><li><p>一段时间如何定义</p></li><li><p>价格区间如何定义</p></li><li><p>收敛又该如何定义</p></li><li><p>定义『价格区间上沿』为 <code>P1</code> 『区间下沿』为 <code>P2</code></p></li><li></li></ul><h3 id=用波动率来处理收敛>用波动率来处理收敛</h3><p>波动率处理收敛有两种方法</p><ol><li>atr 『持续一段时间』低于长期 atr 的平均值</li><li>计算方差，方差为负且越小说明当前 atr 偏离（低）于均值</li></ol><blockquote><p>突破需要在收敛发生的 △T3 时间内视为有效收敛后的突破</p></blockquote><p>假设采用方法1</p><p>需要定义</p><ul><li>持续一段时间 <code>△T1</code></li><li>长期为 <code>△T2</code></li></ul><blockquote><p>『持续低于』的数学解释就是：一组数据里面的最大值低于某个值</p></blockquote><p>由此得到</p><ul><li><code>△T1</code></li><li><code>△T2</code></li><li><code>P1</code></li><li><code>P2</code></li></ul><h2 id=入场信号处理>入场信号处理</h2><ul><li>持续收敛</li><li>发生突破</li></ul><p>数学处理</p><p>突破那一刻的波动率为 ATR_b, 此时的 atr 均值为 ATR_avg = ta.atr(L)
需要满足条件</p><ul><li>close >= P1 OR close &lt;= P2</li><li>ATR_b &lt;= ATR_avg</li></ul><p>由于我们需要的是持续一段时间的收敛，所以单纯的一个点的 ATR 显然不能满足我们的需求。同时又是在 △T3 时间范围内发生突破</p><p><code>ATR_b = ta.lowest(ta.highest(ta.atr(L0), L1)), L3) L1 = △T1/KL L3 = △T3/KL</code>
<code>ATR_avg = ta.sma(ta.atr(L0), L2) L2 = △T2/KL</code></p><h2 id=交易系统的逻辑>交易系统的逻辑</h2><blockquote><p>市场经过一段时间再一个价格区间内无规则的收敛震荡运动后大概率会出现向上或者向下的趋势行情，在价格突破/跌破区间上下沿的时候买入/卖出
取初始止损为区间的中线+atr
取跟踪止损为ema(lenghtX)</p></blockquote><h2 id=最终模型>最终模型</h2><ul><li>KL 当前的K线级别比如，15min 1h</li><li><code>L0</code> ATR 取值时候的基本长度单位默认取 1 or 14</li><li><code>△T1</code> 收敛时间长度</li><li><code>△T2</code> 长期 ATR 均值的时间长度定义</li><li><code>△T3</code> 收敛后在这个时间内发生的突破为有效突破</li><li><code>P0</code> 区间价格上沿</li><li><code>P1</code> 区间价格下沿</li></ul><h2 id=对模型的取值进行优化>对模型的取值进行优化</h2><blockquote><p>任何事物必然需要有一个理论基础作为指导</p></blockquote><p>定义短期趋势：15min级别的小趋势为短期趋势，采用 ema15 作为跟踪止损</p><p>回测样本数据选取，根据特征，短期趋势多发于中期趋势跟长期趋势中</p><h3 id=策略模型取值问题>策略模型取值问题</h3><p>穷举出所有的参数组合，通过样本数据回测得到最优的参数输入。</p><ul><li>KL = 1</li><li>△T1 = 100H L1 = 100</li><li>△T2 = 618H L2 = 618</li><li>△T3 = 30H L3 = 30</li><li>ema = 30</li><li>atr multi = 2</li></ul><h3 id=回测样本数据选取>回测样本数据选取</h3><h4 id=模型取值一>模型取值一</h4><p>2022-12-29
now
长期趋势初期</p><p><img src=/images/trading/backtrade/Quantitative-Strategy-R-D-Guide_1.png alt=取值一></p><p><img src=/images/trading/backtrade/s2_m1.png alt></p><p>2022-11-10
2023-01-07
底部震荡</p><p><img src=/images/trading/backtrade/Quantitative-Strategy-R-D-Guide_mode1_2.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_2.png alt></p><p>2022-06-18
2022-11-06
下降趋势中的震荡</p><p><img src=/images/trading/backtrade/Quantitative-Strategy-R-D-Guide_mode1_3.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_3.png alt></p><p>2021-11-09
2022-11-12
熊市</p><p>2022-04-03
2022-06-21
熊市下跌趋势</p><p><img src=/images/trading/backtrade/Quantitative-Strategy-R-D-Guide_mode1_4.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_4.png alt></p><p>2021-02-20
2022-04-05
顶部大震荡</p><p><img src=/images/trading/backtrade/s1_m1_5.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_5.png alt></p><p>2020-09-19
2021-04-14
牛市上涨趋势</p><p><img src=/images/trading/backtrade/s1_m1_6.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_6.png alt></p><p>2020-03-13
2020-10-08
牛初震荡上涨</p><p><img src=/images/trading/backtrade/s1_m1_7.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_7.png alt=取值一></p><p>2018-12-14
2019-04-01
底部震荡
<img src=/images/trading/backtrade/s1_m1_8.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_8.png alt></p><p>2019-03-18
2019-06-28
牛市上涨趋势
<img src=/images/trading/backtrade/s1_m1_9.png alt=取值一>
<img src=/images/trading/backtrade/s2_m1_9.png alt=取值一></p><h1 id=最终模型收益>最终模型收益</h1><p><img src=/images/trading/backtrade/s1_m1_0.png alt=取值一></p></article></div><div class="column is-hidden-mobile"><div class=sidebar id=toc><div class="post post-toc" id=post-toc></div></div></div></div></div></div></section></div><footer class=footer><div class="content has-text-centered"><p>Powered by <a href=https://gohugo.io>Hugo</a>. Theme <a href=https://www.github.com/wlh320/hugo-theme-hulga>Hulga</a></p><p>Copyright © 2022 jerrkill. All rights reserved.</p></div></footer><script src=https://jerrkill.github.io/js/pwa.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42,backgroundColor:"#1793d0",innerHTML:'<svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>',textColor:"#fff"})</script>
<script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t);e.classList.toggle("is-active"),n.classList.toggle("is-active")})})})</script><link id=hlcss rel=stylesheet type=text/css><script>function addCss(e){var t=document.getElementById("hlcss");t.href=e}var darkcss="https://jerrkill.github.io/css/monokai.css",lightcss="https://jerrkill.github.io/css/monokailight.css";window.matchMedia("(prefers-color-scheme)").media==="not all"?addCss(lightcss):addCss(window.matchMedia("(prefers-color-scheme: dark)").matches?darkcss:lightcss),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches&&addCss(darkcss)),window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&addCss(lightcss))</script><script src=https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js></script><script>anchors.options={placement:"left",icon:"#"},anchors.add(".content h1, .content h2, .content h3")</script>
<link rel=stylesheet type=text/css href=https://jerrkill.github.io/css/toc.min.css><script src=https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js></script>
<script>tocbot.init({tocSelector:".post-toc",contentSelector:"#post-content",headingSelector:"h1, h2, h3",collapseDepth:0,scrollSmooth:!0,positionFixedSelector:".post-toc",fixedSidebarOffset:273})</script></body></html>